<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- ✅ CSS -->
  <link rel="stylesheet" href="./css/bootstrap.min.css">
  <link rel="stylesheet" href="./css/kiosk.css">
  <link rel="stylesheet" href="./css/splash.css">
  <link rel="stylesheet" href="./css/service.css">
  <link rel="stylesheet" href="./css/menu.css">
  <link rel="stylesheet" href="./css/product-variant.css">
  <link rel="stylesheet" href="./css/cart.css">

  <link rel="stylesheet" href="./css/payment-method.css">
  <link rel="stylesheet" href="./css/qr-code-payment.css">
</head>

<body class="bg-light">
  <div id="kioskApp"></div>

  <!-- templates injected here by kiosk_main.py -->

  <!-- ✅ Vendor JS first -->
  <script defer src="./assets/js/bootstrap.bundle.min.js"></script>

  <!-- ✅ Vue (optional, safe to keep) -->
  <script defer src="./assets/js/vue.global.prod.js"></script>

  <!-- ✅ Core -->
  <script defer src="./js/core/tpl.js"></script>
  <script defer src="./js/core/api.js"></script>
  <script defer src="./js/core/router.js"></script>

  <!-- ✅ Modules -->
  <script defer src="./js/modules/splash.js"></script>
  <script defer src="./js/modules/service.js"></script>
  <script defer src="./js/modules/menu.js"></script>
  <script defer src="./js/modules/product-variant.js"></script>
  <script defer src="./js/modules/cart.js"></script>



  <!-- later add: service.js, menu.js, product.js ... -->

  <!-- ✅ Start app last -->
  <script defer src="./app.js"></script>

<template id="tpl-cart">
<div class="c1">

  <!-- TOP BAR -->
  <div class="c1-top">
    <button class="c1-back" type="button" @click="goMenu">← Back</button>
    <div class="c1-title">Your Order</div>
    <div style="width:90px;"></div>
  </div>

  <!-- BODY -->
  <div class="c1-body">

    <div v-if="!lines.length" class="c1-empty">
      Your cart is empty
    </div>

    <div v-else class="c1-list">

      <div v-for="(it, idx) in lines" :key="idx" class="c1-item">

        <!-- image -->
        <div class="c1-thumb">
          <img
            class="c1-img"
            :src="img(it.image_path)"
            @error="e => e.target.src='./assets/placeholder.png'"
            alt=""
          >
        </div>

        <!-- info -->
        <div class="c1-item-main">
          <div class="c1-name">{{ it.name }}</div>

          <div v-if="it.variants && it.variants.length" class="c1-variants">
            <div v-for="(v, vi) in it.variants" :key="vi" class="c1-varline">
              <span class="c1-vg">{{ v.group_name }}</span>
              <span class="c1-vv">{{ v.value_name }}</span>
              <span v-if="Number(v.extra_price || 0) > 0" class="c1-vp">
                +{{ Number(v.extra_price).toFixed(2) }}
              </span>
            </div>
          </div>

          <div class="c1-meta">
            <div class="c1-qtybox">
              <button class="c1-qtybtn" type="button" @click="decQty(idx)">−</button>
              <div class="c1-qtynum">{{ it.qty }}</div>
              <button class="c1-qtybtn" type="button" @click="incQty(idx)">+</button>
            </div>

            <div class="c1-price">
              $ {{ Number(it.line_total || 0).toFixed(2) }}
            </div>
          </div>
        </div>

        <!-- actions -->
        <div class="c1-actions">
          <button class="c1-btn c1-edit" type="button" @click="editItem(idx)">
            Edit
          </button>
          <button class="c1-btn c1-remove" type="button" @click="removeItem(idx)">
            Remove
          </button>
        </div>

      </div>

    </div>
  </div>

  <!-- FOOTER -->
  <div class="c1-footer">
    <div class="c1-totalbox">
      <div class="c1-total-label">Total</div>
      <div class="c1-total">$ {{ total.toFixed(2) }}</div>
      <div class="c1-count">{{ count }} items</div>
    </div>

    <button class="c1-confirm" type="button" :disabled="count === 0" @click="confirmOrder">
      Confirm Order
    </button>
  </div>

</div>

</template>


<template id="tpl-category">
<div
  v-for="c in store.categories"
  :key="c.id"
  v-if="c"
  class="menu-category"
  :class="{ active: c.id === store.catalog.categoryId }"
  @click="selectCategory(c.id)"
>
  <img
    class="menu-category-img"
    :src="img(c)"
    alt=""
  />
  <div class="menu-category-name">{{ c.name }}</div>
</div>

</template>


<template id="tpl-checkout-footer">
<div class="checkout-footer">
  <div class="footer-left">
    <button class="btn btn-light btn-lg w-100" @click="$emit('back')">
      Back
    </button>
  </div>

  <div class="footer-center">
    <div class="footer-total-label">Total</div>
    <div class="footer-total-amount">
      $ {{ total.toFixed(2) }}
    </div>
    <div class="footer-total-items">
      {{ count }} items
    </div>
  </div>

  <div class="footer-right">
    <button
      class="btn btn-warning btn-lg w-100"
      :disabled="count === 0"
      @click="$emit('checkout')"
    >
      Checkout
    </button>
  </div>
</div>

</template>


<template id="tpl-menu">
<div class="m2">

  <!-- TOP ICON CATEGORY ROW -->
  <div class="m2-top">
    <div class="m2-catbar">
      <button
        v-for="c in safeCategories"
        :key="c.id"
        class="m2-cat"
        :class="{ active: Number(store.catalog.categoryId) === Number(c.id) }"
        @click="selectCategory(c.id)"
        type="button"
      >
        <img class="m2-catimg" :src="img(c.image_path)" @error="e=>e.target.src='./assets/placeholder.png'" alt="">
        <div class="m2-catname">{{ c.name }}</div>
      </button>
    </div>
  </div>

  <!-- SUB CATEGORY PILL ROW -->
  <div class="m2-subwrap">
    <div class="m2-subbar">
      <button
        v-for="s in safeSubCategories"
        :key="s.id"
        class="m2-pill"
        :class="{ active: Number(store.catalog.subCategoryId) === Number(s.id) }"
        @click="selectSubCategory(s.id)"
        type="button"
      >
        <img class="m2-pillicon" :src="img(s.image_path)" @error="e=>e.target.src='./assets/placeholder.png'" alt="">
        <span>{{ s.name }}</span>
      </button>
    </div>
  </div>

  <!-- PRODUCT GRID -->
  <div class="m2-body">
    <div class="m2-grid">
      <button
        v-for="p in safeProducts"
        :key="p.id"
        class="m2-card"
        @click="openProduct(p)"
        type="button"
      >
        <div class="m2-prdimgwrap">
          <img class="m2-prdimg" :src="img(p.image_path)" @error="e=>e.target.src='./assets/placeholder.png'" alt="">

          <div
            v-if="(cartQtyByProduct[Number(p.id)] || 0) > 0"
            class="m2-prdbadge"
          >
            {{ cartQtyByProduct[Number(p.id)] }}
          </div>
        </div>

        <div class="m2-prdname">{{ p.name }}</div>
        <div class="m2-prdprice">$ {{ Number(p.base_price || 0).toFixed(2) }}</div>
      </button>

    </div>

    <div v-if="!safeProducts.length && !store.loading" class="m2-empty">
      No products
    </div>
  </div>

  <!-- BOTTOM BAR -->
  <div class="m2-footer">
    <button class="m2-back" type="button" @click="goService">Back</button>

    <div class="m2-total">
      <div class="m2-total-label">Total</div>
      <div class="m2-total-row">
        <div class="m2-bubble">{{ count }}</div>
        <div class="m2-total-amount">$ {{ total.toFixed(2) }}</div>
      </div>
    </div>

    <button class="m2-checkout" type="button" :disabled="count===0" @click="goCheckout">
      Checkout
    </button>
  </div>

</div>

</template>


<template id="tpl-product-variant">
<div class="pv2">
  <!-- TOP YELLOW HEADER -->
  <div class="pv2-top">
    <button class="pv2-discard" type="button" @click="cancel">✕ <span>Discard</span></button>
    <div class="pv2-title">{{ product?.name || 'Product' }}</div>
  </div>

  <!-- IMAGE CENTER -->
  <div class="pv2-hero">
    <div class="pv2-imgcard">
      <img class="pv2-img" :src="img(product?.image_path)" @error="e => e.target.src='./assets/placeholder.png'" alt="">
    </div>
  </div>

  <!-- OPTIONS (✅ force rerender with key) -->
  <div class="pv2-body" :key="renderTick">

    <div v-for="g in groups" :key="g.id" class="pv2-group">
      <div class="pv2-grouphead">
        <div class="pv2-groupname">{{ g.name }}</div>
        <span v-if="g.is_required" class="pv2-required">Required</span>
      </div>

      <div class="pv2-grid">
        <button
          v-for="v in (valuesByGroup[g.id] || [])"
          :key="v.id"
          class="pv2-opt"
          :class="{ active: isSelected(g.id, v.id) }"
          type="button"
          @click.stop="toggleValue(g, v)"
        >
          <span class="pv2-optname">{{ v.name }}</span>

          <span v-if="Number(v.extra_price || 0) > 0" class="pv2-extra">
            + $ {{ Number(v.extra_price).toFixed(2) }}
          </span>
        </button>
      </div>
    </div>

  </div>

  <!-- FLOATING QTY -->
  <div class="pv2-qty">
    <button class="pv2-qtybtn" type="button" @click="decQty">−</button>
    <div class="pv2-qtynum">{{ qty }}</div>
    <button class="pv2-qtybtn" type="button" @click="incQty">+</button>
  </div>

  <!-- BOTTOM BAR -->
  <div class="pv2-bottom">
    <div class="pv2-totalbox">
      <div class="pv2-total-label">Selection</div>
      <div class="pv2-total">$ {{ lineTotal.toFixed(2) }}</div>
    </div>

    <button class="pv2-add" type="button" @click="addToCart">
      Add to cart
    </button>
  </div>
</div>

</template>


<template id="tpl-product">
<div
  v-for="p in store.products"
  :key="p.id"
  v-if="p"
  class="product-card"
  @click="openProduct(p)"
>
  <img
    class="product-img"
    :src="img(p)"
    alt=""
  />
  <div class="product-info">
    <div class="product-name">{{ p.name }}</div>
    <div class="product-price">{{ formatMoney(p.base_price) }}</div>
  </div>
</div>

</template>


<template id="tpl-service">
<div class="svc-screen">
  <button class="btn btn-outline-secondary svc-back" @click="goSplash">
    Splash
  </button>

  <div class="svc-container">
    <h1 class="svc-title">Where do you want to eat?</h1>
    <p class="svc-subtitle">Choose Options</p>

    <div class="svc-options">
      <!-- Dine In -->
      <div class="svc-card"
           :class="{ selected: service === 'dine_in' }"
           @click="selectService('dine_in')">
        <div class="svc-icon">
          <img src="./assets/service/dine_in.png" alt="Dine In">
        </div>
        <div class="svc-card-title">Dine In</div>
        <div class="svc-card-desc">Enjoy your meal here</div>
      </div>

      <!-- Take Away -->
      <div class="svc-card"
           :class="{ selected: service === 'take_away' }"
           @click="selectService('take_away')">
        <div class="svc-icon">
          <img src="./assets/service/take_away.png" alt="Take Away">
        </div>
        <div class="svc-card-title">Take Away</div>
        <div class="svc-card-desc">Pack your order to go</div>
      </div>
    </div>

    <div class="svc-actions">
      <button class="btn btn-success svc-continue"
              :disabled="!service"
              @click="continueService">
        Continue
      </button>
    </div>
  </div>
</div>

</template>


<template id="tpl-splash">
<div class="splash-wrap">

  <div id="splashCarousel"
       class="carousel slide carousel-fade vh-100"
       data-bs-touch="false"
       data-bs-pause="false">

    <div class="carousel-inner vh-100">
      <div class="carousel-item active vh-100">
        <img src="./assets/splash/1.png" class="d-block w-100 splash-img" alt="1">
      </div>
      <div class="carousel-item vh-100">
        <img src="./assets/splash/2.png" class="d-block w-100 splash-img" alt="2">
      </div>
      <div class="carousel-item vh-100">
        <img src="./assets/splash/3.png" class="d-block w-100 splash-img" alt="3">
      </div>
      <div class="carousel-item vh-100">
        <img src="./assets/splash/4.png" class="d-block w-100 splash-img" alt="4">
      </div>
      <div class="carousel-item vh-100">
        <img src="./assets/splash/5.png" class="d-block w-100 splash-img" alt="5">
      </div>
    </div>

    <div class="carousel-indicators">
      <button type="button" data-bs-target="#splashCarousel" data-bs-slide-to="0" class="active"></button>
      <button type="button" data-bs-target="#splashCarousel" data-bs-slide-to="1"></button>
      <button type="button" data-bs-target="#splashCarousel" data-bs-slide-to="2"></button>
      <button type="button" data-bs-target="#splashCarousel" data-bs-slide-to="3"></button>
      <button type="button" data-bs-target="#splashCarousel" data-bs-slide-to="4"></button>
    </div>
  </div>

  <div class="splash-bottom d-flex justify-content-center align-items-center">
    <button class="btn btn-primary btn-lg w-50 py-3 fw-bold"
            @click="goService">
      Order Now
    </button>
  </div>

</div>

</template>


<template id="tpl-sub-category">
<div
  v-for="sc in store.subCategories"
  :key="sc.id"
  v-if="sc"
  class="menu-sub-category"
  :class="{ active: sc.id === store.catalog.subCategoryId }"
  @click="selectSubCategory(sc.id)"
>
  <img
    class="menu-sub-category-img"
    :src="img(sc)"
    alt=""
  />
  <div class="menu-sub-category-name">{{ sc.name }}</div>
</div>

</template>

</body>
</html>
